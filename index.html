<!DOCTYPE html>
<html lang="pt-BR">
<head>

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-TK11YPT954"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-TK11YPT954');
</script>
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SEDECTI</title>
    <style>

.footer-info {
    font-size: 0.8rem; /* Fonte pequena para discrição */
    color: rgba(250, 230, 255, 0.80); /* Cor magenta com 80% de opacidade */
    text-align: right; /* Alinha o texto à direita */
    padding: 10px 20px; /* Adiciona um preenchimento para não colar na borda */
    margin-top: 20px; /* Adiciona um espaço acima do elemento */
    /* Remove as propriedades 'position', 'bottom', 'left', 'transform' para não ser fixo */
}

/* Ajustes para responsividade */
@media (max-width: 768px) {
    .footer-info {
        font-size: 0.65rem; /* Fonte ainda menor em telas pequenas */
        padding: 5px 10px; /* Ajusta o preenchimento */
        text-align: rigt; /* Centraliza em telas muito pequenas, se preferir */
    }
}


        /* Estilos CSS */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 99%;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            color: white;
            padding: 30px;
            text-align: center;
            border-radius: 15px 15px 0 0;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header h2 {
            font-size: 1.2rem;
            font-weight: 300;
            opacity: 0.9;
            max-width: 800px;
            margin: 0 auto;
        }

        .search-section {
            padding: 25px 40px;
            background: #f8f9fa;
            position: relative; /* Adicionado para posicionamento da mensagem de erro e sugestões */
        }

        .search-container {
            position: relative;
            max-width: 600px;
            margin: 0 auto;
        }

        .search-input {
            width: 100%; /* Volta a ocupar 100% */
            padding: 15px 20px; /* Tamanho original */
            font-size: 16px; /* Tamanho original */
            border: 2px solid #ddd;
            border-radius: 10px;
            outline: none;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            padding-right: 110px; /* Espaço para o botão, como no original */
        }

        .search-input:focus {
            border-color: #3498db;
            box-shadow: 0 6px 12px rgba(52, 152, 219, 0.2);
        }

        .select-btn { /* Estilo do botão Selecionar */
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .select-btn:hover {
            background: linear-gradient(135deg, #2980b9, #1f618d);
            transform: translateY(-50%) scale(1.05);
        }

        /* Estilos para o botão Limpar Consulta quando criado dinamicamente */
        /* Ele herdará os estilos de .export-buttons button */
        .export-buttons button {
            background: #28a745;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.3s ease;
            margin-left: 10px;
        }

        .export-buttons button:hover {
            background: #218838;
        }

        /* Se quisermos um estilo diferente para o botão de limpar, podemos adicionar uma classe específica */
        .export-buttons .clear-btn-dynamic {
            background: linear-gradient(135deg, #e74c3c, #c0392b); /* Vermelho */
        }

        .export-buttons .clear-btn-dynamic:hover {
            background: linear-gradient(135deg, #c0392b, #a93226);
        }


        .suggestions {
            position: absolute;
            top: 100%; /* Ajuste para ficar abaixo do search-container */
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #ddd;
            border-top: none;
            border-radius: 0 0 10px 10px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
            max-width: 600px; /* Alinhar com o max-width do search-container */
            margin: 0 auto; /* Centralizar */
        }
        
        .suggestion-item {
            padding: 12px 20px;
            cursor: pointer;
            border-bottom: 1px solid #f0f0f0;
            transition: background 0.2s ease;
        }

        .suggestion-item:hover {
            background: #f8f9fa;
        }

        .suggestion-item:last-child {
            border-bottom: none;
        }

        .company-info {
            padding: 25px 40px;
            display: none;
        }

        .company-header {
            background: linear-gradient(135deg, #e8f4f8, #f8f9fa);
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 5px solid #3498db;
        }

        .company-name {
            font-size: 1.5rem;
            color: #2c3e50;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .company-address {
            font-size: 1rem;
            color: #34495e;
            line-height: 1.4;
        }

        .table-container {
            overflow-x: auto;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }

        th {
            background: linear-gradient(135deg, #34495e, #2c3e50);
            color: white;
            padding: 15px 12px;
            text-align: left;
            font-weight: 600;
            font-size: 0.9rem;
            vertical-align: top;
        }

        td {
            padding: 12px;
            border-bottom: 1px solid #ecf0f1;
            vertical-align: top;
            font-size: 0.9rem;
        }

        tr:nth-child(even) {
            background: #f8f9fa;
        }

        tr:hover {
            background: #e8f4f8;
            transition: background 0.2s ease;
        }
        
        .col-ie {
            min-width: 115px;
            white-space: nowrap;
        }

        /* Classes para alinhamento no HTML */
        .col-ce, .col-obs, .col-grupo {
            text-align: center;
        }
        
        .grupo-discreto {
            color: #7f8c8d;
            font-size: 0.85rem;
            text-align: center; 
        }

        .enquadramento-item {
            white-space: nowrap; /* Impede a quebra de linha indesejada dentro do texto */
        }

        .no-data {
            text-align: center;
            padding: 40px;
            color: #7f8c8d;
            font-size: 1.1rem;
        }

        .error-message {
            color: #dc3545;
            font-size: 0.9rem;
            margin-top: 10px;
            text-align: center;
            display: none; /* Escondido por padrão */
        }

        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: none; /* Escondido por padrão */
            margin-left: 10px;
            vertical-align: middle;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .export-buttons {
            margin-top: 20px;
            text-align: right;
            /* Usar flexbox para alinhar os botões lado a lado */
            display: flex;
            justify-content: flex-end; /* Alinha os itens à direita */
            gap: 10px; /* Espaço entre os botões */
        }
        
        /* NOVO: Estilo para a seção de observações */
        .observations-section {
            padding: 15px 40px;
            font-size: 0.85rem; /* Fonte pequena */
            color: #555;
            line-height: 1.5;
            margin-top: 15px;
            background-color: #f8f9fa;
            border-radius: 0 0 10px 10px;
        }
        .observations-section strong {
            color: #2c3e50; /* Cor mais escura para o título */
        }
        .observations-section p {
            margin-bottom: 1em; /* Espaçamento entre as observações */
        }


        /* Removido o estilo específico de .export-buttons button para que o botão de limpar possa ter seu próprio estilo se necessário */
        /* E para que não haja conflito com o .select-btn se você decidir usar a mesma classe */

        /* Melhoria na responsividade */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .header h2 {
                font-size: 1rem;
            }

            .search-section, .company-info {
                padding: 20px;
            }
            
            .company-name {
                font-size: 1.5rem;
            }

            .table-container {
                font-size: 0.8rem;
            }
            
            th, td {
                padding: 8px;
            }

            .export-buttons {
                flex-direction: column; /* Empilha os botões em telas menores */
                align-items: stretch; /* Estica os botões para a largura total */
                text-align: center; /* Centraliza o texto dentro dos botões empilhados */
            }

            .export-buttons button {
                margin: 5px 0; /* Espaço entre os botões empilhados */
                width: 100%;
            }

            /* Em telas pequenas, o input e o botão ficam em linhas separadas */
            .search-container {
                display: block; /* Remove flex para empilhar */
            }

            .search-input {
                padding-right: 20px; /* Remove o padding extra que era para o botão posicionado */
            }

            .select-btn {
                position: static; /* Remove posicionamento absoluto */
                transform: none;
                margin-top: 10px; /* Adiciona espaço entre input e botão */
                width: 100%;
            }
            
            .suggestions {
                width: 100%;
                left: 0;
                transform: translateX(0);
                margin: 0;
            }
        }
    </style>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>SEDECTI</h1>
            <h2>Consulta às informações preliminares para emissão dos novos Decretos Concessivos, que substituirão os atuais, que estão prorrogados até 05 de outubro de 2025</h2>
        </div>

        <div class="search-section">
            <div class="search-container">
                <input type="text" id="cnpjInput" class="search-input" placeholder="Digite o CNPJ ou Razão Social da empresa..." maxlength="100" autocomplete="off">
                <button class="select-btn" onclick="app.selectCompany()">Selecionar</button>
            </div>
            <div class="suggestions" id="suggestions"></div>
            <div class="error-message" id="errorMessage"></div>
            <div class="loading-spinner" id="loadingSpinner"></div>
        </div>

        <div class="company-info" id="companyInfo">
            <div class="company-header">
                <div class="company-name" id="companyName"></div>
                <div class="company-address" id="companyAddress"></div>
            </div>

            <div class="table-container">
                <table>
                    <thead>
                        <tr>

        <th class="col-numero">Nº</th> <th class="col-ie">I.E.</th>
        <th>Tipo de Bem</th>
        <th>Produto</th>
        <th>NCM</th>
        <th>Enquadramento</th>
        <th class="col-ce">C.E.</th>
        <th class="col-obs">Obs.</th>
        <th class="col-grupo">Grupo</th>

                        </tr>
                    </thead>
                    <tbody id="incentivesTable"></tbody>
                </table>
            
                <div class="export-buttons" id="exportButtons">
                    <button onclick="app.exportToPDF()">Exportar para PDF</button>
                    </div>
            </div>
             <div id="observationsContainer" class="observations-section"></div>
        </div>
    </div>

    <script>
        const empresasData = 















;

        const observacoesMap = {
            "1": "Aplicar-se-á o DIFERIMENTO nas hipóteses previstas no art. 9 do Regulamento aprovado pelo Decreto nº 47.727, de 05 de julho de 2023.",
            "2": "Na saída do produto para indústrias não incentivadas ou localizadas em outras unidades da Federação, o incentivo fiscal de crédito estímulo será de 100%, conforme previsto no inciso I, do parágrafo 18º, do art. 8º, do Regulamento aprovado pelo Decreto nº 47.727, de 05 de julho de 2023.",
            "3": "Na saída do produto para indústrias não incentivadas ou localizadas em outras unidades da Federação, o incentivo fiscal de crédito estímulo será de 100%, conforme previsto no inciso II, do parágrafo 18º, do art. 8º, do Regulamento aprovado pelo Decreto nº 47.727, de 05 de julho de 2023.",
            "4": "Na saída do produto para indústrias não incentivadas ou localizadas em outras unidades da Federação, o incentivo fiscal de crédito estímulo será de 100%, conforme previsto no inciso III, do parágrafo 18º, do art. 8º, do Regulamento aprovado pelo Decreto nº 47.727, de 05 de julho de 2023.",
            "5": "Aplicar-se-á o nível de crédito estímulo correspondente a 75% (setenta e cinco por cento) para os bens finais quando destinados diretamente às empresas de construção civil, conforme previsto no § 12, do Art. 8, do Regulamento aprovado pelo Decreto nº 47.727, de 05 de julho de 2023.",
            "6": "Nos casos em que for comprovado o restabelecimento das condições de competitividade, o nível de crédito estimulo será o correspondente ao percentual de 55%, conforme art. 8, III do Decreto Regulamentador nº 47.727 de 2023."
        };

        const app = {
            elements: {
                cnpjInput: document.getElementById('cnpjInput'),
                suggestions: document.getElementById('suggestions'),
                companyInfo: document.getElementById('companyInfo'),
                companyName: document.getElementById('companyName'),
                companyAddress: document.getElementById('companyAddress'),
                incentivesTable: document.getElementById('incentivesTable'),
                errorMessage: document.getElementById('errorMessage'),
                loadingSpinner: document.getElementById('loadingSpinner'),
                exportButtons: document.getElementById('exportButtons'), 
                observationsContainer: document.getElementById('observationsContainer') 
            },
            selectedCompany: null,
            debounceTimer: null,

            init() {
                this.addEventListeners();
            },

            addEventListeners() {
                this.elements.cnpjInput.addEventListener('input', this.handleInput.bind(this));
                this.elements.cnpjInput.addEventListener('keypress', this.handleKeyPress.bind(this));
                document.addEventListener('click', this.handleClickOutside.bind(this));
            },

            handleInput(e) {
                this.clearMessage();
                clearTimeout(this.debounceTimer);
                this.debounceTimer = setTimeout(() => {
                    this.showSuggestions(e.target.value);
                }, 300);
            },

            handleKeyPress(e) {
                if (e.key === 'Enter') {
                    this.selectCompany();
                }
            },

            showLoading(show) {
                this.elements.loadingSpinner.style.display = show ? 'inline-block' : 'none';
            },

            displayMessage(message, isError = false) {
                this.elements.errorMessage.textContent = message;
                this.elements.errorMessage.style.color = isError ? '#dc3545' : '#28a745';
                this.elements.errorMessage.style.display = 'block';
            },

            clearMessage() {
                this.elements.errorMessage.textContent = '';
                this.elements.errorMessage.style.display = 'none';
            },

            showSuggestions(query) {
                if (!query || query.trim().length === 0) {
                    this.elements.suggestions.style.display = 'none';
                    return;
                }

                const lowerCaseQuery = query.toLowerCase();
                const filtered = empresasData.filter(empresa =>
                    empresa.cnpj.includes(lowerCaseQuery) ||
                    empresa.razaoSocial.toLowerCase().includes(lowerCaseQuery)
                );

                if (filtered.length > 0) {
                    const limitedSuggestions = filtered.slice(0, 10);
                    this.elements.suggestions.innerHTML = limitedSuggestions.map(empresa =>
                        `<div class="suggestion-item" onclick="app.selectSuggestion('${empresa.cnpj}')">
                            <strong>${this.escapeHTML(empresa.razaoSocial)}</strong><br>
                            <small>${this.escapeHTML(empresa.cnpj)}</small>
                        </div>`
                    ).join('');
                    this.elements.suggestions.style.display = 'block';
                } else {
                    this.elements.suggestions.style.display = 'none';
                }
            },

            selectSuggestion(cnpj) {
                this.elements.cnpjInput.value = cnpj;
                this.elements.suggestions.style.display = 'none';
                this.selectCompany();
            },
            
            selectCompany() {
                this.showLoading(true);
                this.clearMessage();
                this.elements.companyInfo.style.display = 'none';
                this.removeClearButton(); 

                const rawInput = this.elements.cnpjInput.value.trim();
                const lowerCaseInput = rawInput.toLowerCase();
                
                if (!rawInput) {
                    this.displayMessage('Por favor, digite o CNPJ ou Razão Social.', true);
                    this.showLoading(false);
                    return;
                }

                setTimeout(() => {
                    let empresa = empresasData.find(e => e.cnpj === rawInput);
                    if (!empresa) {
                        empresa = empresasData.find(e => e.razaoSocial.toLowerCase().includes(lowerCaseInput));
                    }

                    if (empresa) {
                        this.selectedCompany = empresa;
                        this.displayCompanyInfo(empresa);
                        this.displayMessage('Empresa encontrada com sucesso!');
                        this.addClearButton(); 
                    } else {
                        this.displayMessage('Empresa não encontrada na base de dados.', true);
                        this.selectedCompany = null;
                        this.elements.companyInfo.style.display = 'none';
                        this.removeClearButton(); 
                    }
                    this.showLoading(false);
                }, 500);
            },

            displayCompanyInfo(empresa) {
                this.elements.companyName.textContent = `${this.escapeHTML(empresa.razaoSocial)} (${this.escapeHTML(empresa.cnpj)})`;
                this.elements.companyAddress.textContent = this.escapeHTML(empresa.endereco);

                const tableBody = this.elements.incentivesTable;
                tableBody.innerHTML = '';
                
                const uniqueObsNumbers = new Set();

                if (empresa.incentivos && empresa.incentivos.length > 0) {
                    empresa.incentivos.forEach((incentivo, index) => { 
                        const row = tableBody.insertRow();
                        
                        const numberCell = row.insertCell();
                        numberCell.textContent = index + 1;
                        numberCell.classList.add('col-numero');

                        const tipoBem = incentivo.tipoBem.includes("Erro 2042") ? "Dado inconsistente" : incentivo.tipoBem;
                        const ce = incentivo.ce.includes("Erro 2042") ? "Dado inconsistente" : incentivo.ce;
                        
                        const enquadramentosHtml = incentivo.enquadramento
                            .split(';')
                            .map(e => e.trim())
                            .filter(e => e.length > 0)
                            .map(item => `<span class="enquadramento-item">${this.escapeHTML(item)}</span>`)
                            .join('<br>');

                        row.insertCell().textContent = this.escapeHTML(incentivo.ie);
                        row.insertCell().textContent = this.escapeHTML(tipoBem);
                        row.insertCell().textContent = this.escapeHTML(incentivo.produto);
                        row.insertCell().textContent = this.escapeHTML(incentivo.ncm);
                        
                        const enquadramentoCell = row.insertCell();
                        enquadramentoCell.innerHTML = enquadramentosHtml;

                        const ceCell = row.insertCell();
                        ceCell.textContent = this.escapeHTML(ce);
                        ceCell.classList.add('col-ce');

                        const obsCell = row.insertCell();
                        obsCell.textContent = this.escapeHTML(incentivo.obs);
                        obsCell.classList.add('col-obs');
                        
                        if (incentivo.obs && incentivo.obs.trim() !== "") {
                            uniqueObsNumbers.add(incentivo.obs.trim());
                        }
                        
                        const grupoCell = row.insertCell();
                        grupoCell.classList.add('grupo-discreto', 'col-grupo');
                        grupoCell.textContent = this.escapeHTML(incentivo.grupo);
                    });
                } else {
                    tableBody.innerHTML = '<tr><td colspan="9" class="no-data">Nenhum incentivo encontrado para esta empresa.</td></tr>';
                }
                
                this.displayObservations(uniqueObsNumbers);
                this.elements.companyInfo.style.display = 'block';
            },
            
            displayObservations(obsNumbers) {
                const container = this.elements.observationsContainer;
                container.innerHTML = ''; 
                
                if (obsNumbers.size > 0) {
                    let htmlContent = '<strong>Observações:</strong><br><br>';
                    
                    const sortedObs = Array.from(obsNumbers).sort((a, b) => a - b);
                    
                    sortedObs.forEach(obsNumber => {
                        if (observacoesMap[obsNumber]) {
                            htmlContent += `<p><strong>${obsNumber}.</strong> ${this.escapeHTML(observacoesMap[obsNumber])}</p>`;
                        }
                    });
                    
                    container.innerHTML = htmlContent;
                }
            },

            handleClickOutside(e) {
                if (!e.target.closest('.search-container')) {
                    this.elements.suggestions.style.display = 'none';
                }
            },

            escapeHTML(str) {
                const div = document.createElement('div');
                div.appendChild(document.createTextNode(str));
                return div.innerHTML;
            },

            addClearButton() {
                let clearButton = document.getElementById('clearButton');
                if (!clearButton) {
                    clearButton = document.createElement('button');
                    clearButton.id = 'clearButton';
                    clearButton.classList.add('clear-btn-dynamic');
                    clearButton.textContent = 'Limpar Consulta';
                    clearButton.onclick = () => app.clearSearch();
                    this.elements.exportButtons.appendChild(clearButton);
                }
            },

            removeClearButton() {
                const clearButton = document.getElementById('clearButton');
                if (clearButton) {
                    clearButton.remove();
                }
            },

            clearSearch() {
                this.elements.cnpjInput.value = '';
                this.elements.suggestions.innerHTML = '';
                this.elements.suggestions.style.display = 'none';
                this.elements.companyInfo.style.display = 'none';
                this.elements.observationsContainer.innerHTML = ''; 
                this.clearMessage();
                this.showLoading(false);
                this.selectedCompany = null;
                this.removeClearButton();
            },

            exportToPDF() {
                if (typeof window.jspdf === 'undefined' || typeof window.jspdf.jsPDF === 'undefined') {
                    this.displayMessage('Erro: A biblioteca jsPDF não foi carregada. Verifique sua conexão com a internet.', true);
                    return;
                }

                const { jsPDF } = window.jspdf;
                const doc = new jsPDF({
                    orientation: 'p',
                    unit: 'mm',
                    format: 'a4'
                });

                const empresa = this.selectedCompany;
                if (!empresa) {
                    this.displayMessage('Nenhuma empresa selecionada para exportar.', true);
                    return;
                }

                const pageHeader = (data) => {
                    const pageWidth = doc.internal.pageSize.width;
                    const margin = 10;
                    let headerY = 15;

                    doc.setFontSize(14);
                    doc.setFont('helvetica', 'bold');
                    doc.setTextColor(40);
                    doc.text("Consulta de Incentivos Fiscais", pageWidth / 2, headerY, { align: 'center' });
                    headerY += 8;

                    doc.setDrawColor(221, 221, 221);
                    doc.line(margin, headerY, pageWidth - margin, headerY);
                    headerY += 8;
                    
                    doc.setFontSize(11);
                    doc.setFont('helvetica', 'bold');
                    const razaoSocialLines = doc.splitTextToSize(`${empresa.razaoSocial} (${empresa.cnpj})`, pageWidth - margin * 2);
                    doc.text(razaoSocialLines, margin, headerY);
                    
                    headerY += (razaoSocialLines.length * 5); 

                    doc.setFontSize(9);
                    doc.setFont('helvetica', 'normal');
                    const enderecoLines = doc.splitTextToSize(`Endereço: ${empresa.endereco}`, pageWidth - margin * 2);
                    doc.text(enderecoLines, margin, headerY);
                };
                
                const tableColumnNames = ['Nº', 'I.E.', 'Tipo de Bem', 'Produto', 'NCM', 'Enquadramento', 'C.E.', 'Obs.', 'Grupo'];
                const bodyRows = [];
                const uniqueObsNumbers = new Set();
                
                empresa.incentivos.forEach((i, index) => {
                    const tipoBem = i.tipoBem.includes("Erro 2042") ? "Dado inconsistente" : i.tipoBem;
                    const ce = i.ce.includes("Erro 2042") ? "Dado inconsistente" : i.ce;
                    const enquadramentoFormatado = i.enquadramento.split(';').map(item => item.trim()).filter(Boolean).join('\n'); 

                    bodyRows.push([
                        index + 1, i.ie, tipoBem, i.produto, i.ncm,
                        enquadramentoFormatado, ce, i.obs, i.grupo
                    ]);
                    
                    if (i.obs && i.obs.trim() !== "") {
                        uniqueObsNumbers.add(i.obs.trim());
                    }
                });

                if (uniqueObsNumbers.size > 0) {
                    bodyRows.push([{content: '', colSpan: 9, styles: {minCellHeight: 5}}]); 
                    bodyRows.push([{content: 'Observações:', colSpan: 9, styles: {fontStyle: 'bold', fontSize: 10, halign: 'left'}}]);
                    
                    const sortedObs = Array.from(uniqueObsNumbers).sort((a,b) => a - b);
                    sortedObs.forEach(obsNumber => {
                        if (observacoesMap[obsNumber]) {
                            const text = `${obsNumber}. ${observacoesMap[obsNumber]}`;
                            bodyRows.push([{content: text, colSpan: 9, styles: {halign: 'left'}}]);
                        }
                    });
                }
                
                doc.autoTable({
                    head: [tableColumnNames],
                    body: bodyRows,
                    startY: 50,
                    didDrawPage: pageHeader,
                    margin: { top: 50, left: 10, right: 10 },
                    styles: { 
                        fontSize: 8,
                        overflow: 'linebreak'
                    },
                    headStyles: {
                        fillColor: [44, 62, 80],
                        textColor: 255,
                        fontStyle: 'bold'
                    },
                    columnStyles: {
                        0: { halign: 'center', cellWidth: 10 }, 
                        6: { halign: 'center' }, 
                        7: { halign: 'center' }, 
                        8: { halign: 'center' }
                    },
                    didParseCell: function (data) {
                        if (data.row.raw.colSpan) {
                            data.cell.styles.fillColor = '#ffffff';
                            data.cell.styles.textColor = [40, 40, 40];
                            data.cell.styles.lineWidth = 0;
                        }
                    }
                });

                const pageCount = doc.internal.getNumberOfPages();
                for (let i = 1; i <= pageCount; i++) {
                    doc.setPage(i);
                    const footerText = `Página ${i} de ${pageCount}`;
                    const pageWidth = doc.internal.pageSize.getWidth();
                    doc.setFontSize(8);
                    doc.setTextColor(150);
                    doc.text(footerText, pageWidth / 2, doc.internal.pageSize.height - 10, { align: 'center' });
                }

                const safeFileName = empresa.razaoSocial.replace(/[^\w\s-]/gi, '').trim();
                doc.save(`${safeFileName}.pdf`);
                
                this.displayMessage('Dados exportados para PDF com sucesso!');
            }
}
;

        document.addEventListener('DOMContentLoaded', () => {
            app.init();
        });
    </script>

<div class="footer-info">
    Release 8  (05 de Agosto de 2025 14:15h)
</div>

</body>
</html>





